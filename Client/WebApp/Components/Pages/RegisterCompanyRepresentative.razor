@page "/register-company-representative"
@using System.ComponentModel.DataAnnotations
@using global::DTOs
@using Services
@inject HttpCompanyRepresentativeService HttpCompanyRepresentativeService
@rendermode InteractiveServer

<h3>Create User Profile</h3>

<div class="form-container">
    <EditForm Model="@profile" OnValidSubmit="HandleValidSubmit">
        <DataAnnotationsValidator />

        <div class="form-group">
            <label for="name">Full Name</label>
            <InputText id="name" class="form-control" @bind-Value="profile.Name" />
            <ValidationMessage For="@(() => profile.Name)" class="validation-message" />
        </div>

        <div class="form-group">
            <label for="email">Email</label>
            <InputText id="email" class="form-control" @bind-Value="profile.Email" />
            <ValidationMessage For="@(() => profile.Email)" class="validation-message" />
        </div>

        <div class="form-group">
            <label for="position">Position</label>
            <InputText id="position" class="form-control" @bind-Value="profile.Position" />
            <ValidationMessage For="@(() => profile.Position)" class="validation-message" />
        </div>

        <div class="form-group">
            <label for="password">Password</label>
            <InputText type="password" id="password" class="form-control" @bind-Value="profile.Password" />
            <ValidationMessage For="@(() => profile.Password)" class="validation-message" />
        </div>

        <button type="submit" class="submit-btn">Create Profile</button>
    </EditForm>

    <div class="@($"notification-container {(notificationVisible ? "show" : "")}")">
        <div class="@($"notification {notificationType}")">
            @notificationMessage
        </div>
    </div>
</div>

@code {
    private RepresentativeInfo profile = new();

    private bool notificationVisible = false;
    private string notificationMessage = string.Empty;
    private string notificationType = string.Empty;

    private async void HandleValidSubmit()
    {
        try
        {
            await HttpCompanyRepresentativeService.AddCompanyRepresentativeAsync(new AddCompanyRepresentativeDto
            {
                Name = profile.Name,
                Email = profile.Email,
                Position = profile.Position,
                Password = profile.Password
            });
            ShowNotification("Account created successfully!", "success");
        }
        catch
        {
            ShowNotification("Failed to create account. Please try again.", "error");
        }
        StateHasChanged();
    }

    private void ShowNotification(string message, string type)
    {
        notificationMessage = message;
        notificationType = type;
        notificationVisible = true;

        _ = Task.Delay(3000).ContinueWith(_ =>
        {
            notificationVisible = false;
            InvokeAsync(StateHasChanged);
        });
    }

    public class RepresentativeInfo
    {
        [Required(ErrorMessage = "Name is required.")]
        public string Name { get; set; } = string.Empty;

        [EmailAddress(ErrorMessage = "Invalid email address.")]
        public string Email { get; set; } = string.Empty;

        [Required(ErrorMessage = "Position is required.")]
        public string Position { get; set; } = string.Empty;

        [Required(ErrorMessage = "Password is required.")]
        public string Password { get; set; } = string.Empty;
    }
}